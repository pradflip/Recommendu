@inject RecommenduWeb.Services.PostService PostService
@model RecommenduWeb.Models.ViewModels.PostagemViewModel
@{
    ViewData["Title"] = "Produtos";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="col-3 card-busca">
    <h2 class="text-white pb-2">Encontrar serviço</h2>
    <form asp-action="Servicos" id="formServicos" method="get">
        <div class="d-flex justify-content-center">
            <input class="form-control-1" type="search" value="@ViewData["tituloAtual"]" id="srcTitulo" name="titulo" placeholder="Nome do serviço"/>
            <input class="btn-search align-self-center" type="submit" />
        </div>
        <div class="mt-4 bg-light rounded-3">
            <table class="text-black w-100 mt-2 text-center">
                <tr>
                    <th class="text-white bg-orange py-2 px-0 rounded-2">Buscar por região</th>
                </tr>
                <tr>
                    <td class="p-2 text-start">
                        <label for="ddlEstados">Estado:</label>
                        @Html.DropDownList("GetEstados", (IEnumerable<SelectListItem>)ViewBag.GetEstados, new {@class="form-control-1", id="ddlEstados", @onChange="ListarCidades()"})
                    </td>
                </tr>
                <tr>
                    <td class="p-2 text-start form-control-color">
                        <label for="ddlCidades">Cidade:</label>
                        @Html.DropDownList("GetCidades", (IEnumerable<SelectListItem>)ViewBag.GetCidade, new {@class="form-control-1", id="ddlCidades", @name="GetCidades"})
                    </td>
                </tr>
            </table>
        </div>
    </form>
    <div class="dropdown show mt-5">
        <a class="btn btn-filtro dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Ordenar por
        </a>
        <div class="dropdown-menu text-center mx-3" aria-labelledby="dropdownMenuLink">
            <a class="dropdown-item" asp-action="Servicos" asp-route-titulo="@ViewData["tituloAtual"]" asp-route-GetEstados="@ViewData["estadoAtual"]" asp-route-GetCidade="@ViewData["cidadeAtual"]" asp-route-filtro="recentes">Mais recentes</a>
            <a class="dropdown-item" asp-action="Servicos" asp-route-titulo="@ViewData["tituloAtual"]" asp-route-GetEstados="@ViewData["estadoAtual"]" asp-route-GetCidade="@ViewData["cidadeAtual"]" asp-route-filtro="relevantes">Mais relevantes</a>
        </div>
    </div>
</div>

<div class="col-9 d-flex justify-content-center ms-7">
    @if (Model != null && Model.PostagemServico.Count > 0)
    {
        @foreach (var item in Model.PostagemServico)
        {
            string tempo = PostService.TempoPostagem(item.DtPostagem);

            <div class="card-pub mt-8">
                <div class="card-pub-1 text-light">
                    <div class="card-title text-center">@Html.DisplayFor(modelItem => item.Titulo)</div>
                    <div class="card-seta"></div>
                    <img src="~/Resources/PostImages/@item.ImgPostagem" class="card-img" asp-append-version="true" />
                </div>
                <div class="card-pub-2 p-2">
                    <div class="text-black">
                        <div class="text-start">
                            <img src="~/Resources/ProfileImages/@item.Usuario.ImagemPerfil" class="rounded-circle avatar-circle card-ava" asp-append-version="true" />
                            <b>@Html.DisplayFor(modelItem => item.Usuario.UserName)</b>
                            <div class="float-end me-2 mt-2 fs-6">@Html.DisplayFor(modelItem => tempo)</div>
                        </div>
                    </div>
                    <div class="text-start my-3">
                        <h6 class="p-1 fs-6">
                            Público Alvo: @Html.DisplayFor(modelItem => item.PublicoAlvo)
                        </h6>
                        <h6 class="p-1 fs-6">
                            Categoria: @Html.DisplayFor(modelItem => item.Categoria)
                        </h6>
                        <h6 class="p-1 fs-6">
                            Curtidas: @Html.DisplayFor(modelItem => item.Curtidas)
                        </h6>
                    </div>
                    <div class="my-4 mx-1">
                        <a class="link-primary-1 fs-6" asp-controller="Postagens" asp-action="Details" asp-route-cat="@item.Categoria" asp-route-id="@item.PostagemId">Ver completo</a>
                    </div>
                </div>
            </div>
        }
    }

    @if (Model != null && Model.PostagemServico.Count == 0)
    {
        <div class="bg-light p-2 fw-bold border shadow-sm mb-5 not-result">
            <p>Nenhum resultado encontrado.</p>
        </div>
    }
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
        <script scr="~/js/site.js"></script>
    }
    }